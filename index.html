<script>
    const secretPassword = "coconut";

    // Your content lists
    const library = {
        missMe: ["Note 1", "Note 2", "Note 3"], // Add your 250 here
        feelingLow: ["Encouragement 1", "Encouragement 2"], // Add your 250 here
        reasons: ["Reason 1", "Reason 2", "Reason 3"], // Add your 250 here
        coupon: ["Coupon 1", "Coupon 2"] // Add your 100 here
    };

    // --- DATABASE LOGIC ---
    // This part saves progress to his phone so refreshes don't reset it.
    function getSeen(cat) {
        let seen = localStorage.getItem('seen_' + cat);
        return seen ? JSON.parse(seen) : [];
    }

    function saveSeen(cat, index) {
        let seen = getSeen(cat);
        seen.push(index);
        localStorage.setItem('seen_' + cat, JSON.stringify(seen));
    }

    function showNext(cat) {
        const seenIndices = getSeen(cat);
        
        // Find indices we haven't used yet
        const availableIndices = library[cat]
            .map((_, index) => index)
            .filter(index => !seenIndices.includes(index));

        if (availableIndices.length === 0) {
            document.getElementById('textContent').innerText = "You've seen all the notes in this category! ❤️";
        } else {
            // Pick a random one from the UNSEEN list
            const randomIndex = Math.floor(Math.random() * availableIndices.length);
            const actualIndex = availableIndices[randomIndex];
            
            const pick = library[cat][actualIndex];
            saveSeen(cat, actualIndex); // Mark it as seen forever
            
            document.getElementById('memoryImage').style.display = 'none';
            document.getElementById('textContent').innerText = pick;
        }
        document.getElementById('letter-overlay').style.display = 'flex';
    }

    function showOrderedReason() {
        // We use a different key for ordered reasons to track the current count
        let count = parseInt(localStorage.getItem('reason_count') || "0");
        
        if (count >= library.reasons.length) {
            document.getElementById('textContent').innerText = "You've read all the reasons! I'll have to write more soon. ❤️";
        } else {
            const pick = library.reasons[count];
            localStorage.setItem('reason_count', count + 1);
            
            document.getElementById('memoryImage').style.display = 'none';
            document.getElementById('textContent').innerText = pick;
        }
        document.getElementById('letter-overlay').style.display = 'flex';
    }

    // Standard functions
    function unlock() {
        if(document.getElementById('passInput').value === secretPassword) {
            document.getElementById('login-box').classList.add('hidden');
            document.getElementById('main-content').classList.remove('hidden');
        } else { alert("Try again!"); }
    }
    
    function closeLetter() { document.getElementById('letter-overlay').style.display = 'none'; }
    
    function showMemory() {
        const memories = [{url: "", text: "Add your memory here!"}];
        const pick = memories[Math.floor(Math.random() * memories.length)];
        const img = document.getElementById('memoryImage');
        if(pick.url) { img.src = pick.url; img.style.display = 'block'; }
        document.getElementById('textContent').innerText = pick.text;
        document.getElementById('letter-overlay').style.display = 'flex';
    }
</script>
